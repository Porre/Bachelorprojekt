Vi vil her give et bevis for Hasse's sætning, der giver os en 
(optimal) vurdering af antallet af punkter på en elliptisk kurve.
Til dette
formål skal vi først opbygge nogle resultater vedrørende
endomorfier på endelige legemer, som benyttes i beviset for
dette.

\begin{definition}
En endomorfi på $E$ er en homomorfi $\alpha : E(\clk) \to E(\clk)$ givet
ved rationale funktioner.
\end{definition}

Med en rational funktion forståes en kvotient af polynomier. Det vil altså sige, 
at $\alpha$ skal opfylde at $\alpha(P_1 + P_2)=\alpha(P_1)+\alpha(P_2)$ 
og der skal findes rationale 
funktioner $R_1(x, y)$ og $R_2(x, y)$, begge med koefficienter i $\clk$, så
\begin{align*}
	\alpha(x, y) = (R_1(x, y), R_2(x, y)),
\end{align*}
for alle $(x, y) \in E(\clk)$. Dette giver os også, da $\alpha$ er en homomorfi,
at $\alpha(\infty)=\infty$. Vi vil fremover antage, at $\alpha$ ikke er den 
trivielle endomorfi, altså at der findes $(x, y)$ sådan at $\alpha(x, y) \neq \infty$.

Vi ønsker da, at finde en standard repræsentation for de rationale funktioner, som
beskriver en endomorfi. For en elliptisk kurve $E$ på Weierstrass normalform gælder
der, at $y^2 = x^3 + Ax + B$ for alle $(x, y) \in E(\clk)$, hvilket betyder at
\begin{align*}
	y^{2k} = (x^3 + Ax + B)^k,
\end{align*}
hvor $k \in \mathbb{N}$. På lignende vis har vi også, at 
\begin{align*}
	y^{2k} y = (x^3 + Ax + B)^k y.
\end{align*}
For en rational funktion $R(x, y)$ kan vi nu beskrive en anden rational funktion,
som stemmer overens med denne på punkter fra $E(\clk)$. Vi kan med andre ord antage,
at 
\begin{align}
	\label{rational}
	R(x, y) = \frac{p_1(x) + p_2(x)y}{p_3(x)+p_4(x)y}.
\end{align}
Det er endda muligt, at gøre dette endnu simplere ved at gange udtrykket i \eqref{rational}
med $p_3(x)-p_4(x)y$, da 
\begin{align*}
	(p_3(x) - p_4(x)y)(p_3(x)+p_4(x)y) = p_3(x)^2 - p_4(x)^2 y^2,
\end{align*}
hvorefter vi kan erstatte $y^2$ med $x^3+Ax+B$. Vi får da, at 
\begin{align}
	\label{rational_final}
	R(x, y) = \frac{q_1(x) + q_2(x)y}{q_3(x)}.
\end{align}
Lader vi nu $\alpha$ være en endomorfi givet ved
\begin{align*}
	\alpha(x, y) = (R_1(x, y), R_2(x, y)),
\end{align*}
får vi, da $\alpha$ er en homomorfi, at 
\begin{align*}
	\alpha(x, -y) = \alpha(-(x, y)) - \alpha(x, y).
\end{align*}
Dette medfører, at 
\begin{align*}
	R_1(x, -y) = R_1(x, y) \quad \text{og} \quad R_2(x, -y) = -R_2(x, y).
\end{align*}
Skrives $R_1$ og $R_2$ på samme form som i \eqref{rational_final} følger det da, at 
$q_2(x)=0$ for $R_1$ og $q_1(x)=0$ for $R_2$. Vi kan altså antage, at 
\begin{align*}
	\alpha(x, y) = (r_1(x), r_2(x)y),
\end{align*}
hvor $r_1(x)$ og $r_2(x)$ er rationale funktioner. Skriv da $r_1(x)=p(x)/q(x)$ (opgave om
den rent faktisk er defineret).

\begin{definition}
Graden af en endomorfi $\alpha$ er givet ved
\begin{align*}
	\deg(\alpha) = \max \{ \deg p(x), \deg q(x) \},
\end{align*}
hvis $\alpha$ er ikke-triviel. Hvis $\alpha$ er den trivielle endomorfi lader vi 
$\deg (\alpha) = 0$.
\end{definition}

Vi siger, at $\alpha$ er en separabel endomorfi, hvis den afledede $r_1'(x)$ ikke
er lig nul.


\begin{definition}[Algebraisk aflukning]
En algebraisk aflukning af et legeme $K$, er et legeme
$K \subseteq \overline{K}$, hvor $\overline{K}$ er en 
algebraisk udvidelse af $K$ samt, at ethvert ikke-konstant
polynomium fra $\overline{K}[X]$ har en rod i $\overline{K}$. 
\end{definition}




% Det kan vises, at ethvert legeme har en algebraisk aflukning og
% at to algebraiske aflukninger for det samme legeme vil være isomorfe.
% Derfor giver det mening for os, at snakke om \emph{den} algebraiske
% aflukning for et givent legeme. 


Lad nu $\mathbb{F}_q$ være et endeligt
legeme med algebraisk aflukning $\overline{\mathbb{F}}_q$. Vi ser på
Frobenius afbildningen 
\begin{align*}
	\phi_q : \overline{\mathbb{F}}_q \to \overline{\mathbb{F}}_q,
\end{align*}
som er givet ved, at $x \mapsto x^q$. For en elliptisk kurve $E$ over
$\mathbb{F}_q$ virker $\phi_q$ på koordinaterne $E(\overline{\mathbb{F}}_q)$ 
ved, at 
\begin{align*}
	\phi_q(x, y) = (x^q, y^q), \quad \phi_q (\infty) = \infty.
\end{align*}

I det følgende udnytter vi, at $q$ er et primtal (men bogen arbejder
måske blot med at $q = p^r$, hvor $p$ er et primtal. Da skal der tilføjes
lidt resultater.

\begin{lemma}\label{lemma03}
Lad $E$ være en elliptisk kurve over $\mathbb{F}_q$, og lad 
$(x, y) \in E(\overline{\mathbb{F}}_q)$. Da gælder der, at 
\begin{enumerate}
	\item $\phi_q(x, y) \in E(\overline{\mathbb{F}}_q)$,
	\item $(x, y) \in E(\mathbb{F}_q) \Leftrightarrow \phi_q(x, y)=(x, y)$.
\end{enumerate}
\end{lemma}
\begin{proof}
Vi har, at $y^2 = x^3 + ax + b$, hvor $a, b \in \mathbb{F}_q$. Vi opløfter 
denne ligning til den $q$'ende potens og får, at 
\begin{align*}
	(y^q)^2 = (x^q)^3 + (a^q x^q) + b^q,
\end{align*}
hvor vi har brugt Freshman's dream. Men dette betyder netop, at 
$(x^q, y^q) \in E(\overline{\mathbb{F}}_q)$, hvilket viser (1).
For at vise (2) husker vi, at $\phi_q(x) = x \Leftrightarrow x \in \mathbb{F}_q$.
Det følger da, at 
\begin{align*}
	(x, y) \in E(\mathbb{F}_q) &\Leftrightarrow x, y \in \mathbb{F}_q \\
	&\Leftrightarrow \phi_q(x) = x \ \text{og} \ \phi_q(y) = y \\
	&\Leftrightarrow \phi_q(x, y) = (x, y),
\end{align*}
hvilket fuldfører beviset for (2).
\end{proof}

\begin{lemma}
Lad $E$ være en elliptisk kurve over $\mathbb{F}_q$. Da er $\phi_q$ en 
endomorfi for $E$ af grad $q$, desuden er $\phi_q$ ikke separabel.
\end{lemma}
\begin{proof}
Beviset går på at vise, at $\phi_q : E(\clfq) \to E(\clfq)$ er en homomorfi. 
Dette gøres vha. additionsformlerne. Se f.eks. [1].
\end{proof}

Dette betyder, at ${\phi_q}^2 = \phi_q \circ \phi_q$ også er en endomorfi,
hvilket vi kan udvide til ${\phi_q}^n$ for $n \geq 1$ er en endomorfi. 
Da multiplikation samtidigt er en endomorfi følger det, at ${\phi_q}^n -1$ 
også er det. 

Det næste resultat bliver afgørende for beviset for Hasses sætning. 
Det fortæller os om graden af en endomorfi for en elliptisk kurve $E$,
som eksempelvis $\phi_q$ er det.

\begin{proposition}
Lad $E$ være en elliptisk kurve. Lad $\alpha \neq 0$ være en separabel 
endomorfi for $E$. Da er 
\begin{align*}
	\deg \alpha = \# \ker (\alpha),
\end{align*}
hvor $\ker (\alpha) = $ angiver kernen for homomorfien 
$\alpha : E(\clk) \to E(\clk)$. I tilfældet hvor $\alpha \neq 0$ ikke
er separabel gælder der, at 
\begin{align*}
	\deg \alpha > \# \ker (\alpha).
\end{align*}
\end{proposition}
\begin{proof}
Vi skriver $\alpha$ på standardformen, som vi introducerede tidligere, altså
sættes
\begin{align*}
	\alpha(x, y) = (r_1(x), r_2(x) y)),
\end{align*}
hvor $r_1(x) = p(x)/q(x)$. Da $\alpha$ er antaget til at være separabel er 
$r_1' \neq 0$ og dermed er $pq'-p'q$ ikke nulpolynomiet. Lad nu
\begin{align*}
	S = \{ x \in \clk \mid (pq' - p'q)(x)q(x) = 0 \}.
\end{align*}
Lad da $(a, b) \in E(\clk)$ være valgt sådan, at det opfylder følgende
\begin{enumerate}
	\item $a \neq 0$, $b \neq 0$ og $(a, b) \neq \infty$,
	\item $\deg (p(x) - aq(x)) = \max \{ \deg p(x), \deg q(x) \} = \deg \alpha$,
	\item $a \notin r_1(S)$,
	\item $(a, b) \in \alpha(E(\clk))$.
\end{enumerate}
Da $pq'-p'q$ ikke er 
nulpolynomiet er $S$ en endelig mængde, hvilket dermed også betyder, at 
$\alpha(S)$ er en endelig mængde. Funktionen $r_1(x)$ antager uendeligt 
mange forskellige værdier når $x$ gennemløber $\clk$. 
%da en algebraisk aflukning indeholder uendeligt mange elementer.
Da der for hvert $x$ er et punkt $(x, y) \in E(\clk)$ følger det, at 
$\alpha(E(\clk))$ er en uendelig mængde. Det er altså muligt, at vælge et
punkt $(a, b) \in E(\clk)$ med egenskaberne ovenfor.

Vi ønsker at vise, at der netop er $\deg \alpha$ punkter $(x_1, y_1) \in E(\clk)$ sådan,
at $\alpha(x_1, y_1) = (a, b)$. For et sådan punkt gælder der, at 
\begin{align*}
	\frac{p(x_1)}{q(x_1)} = a, \quad r_2(x_1) y_1 = b.
\end{align*}
Da $(a, b) \neq \infty$ er $q(x_1) \neq 0$. % Øvelse giver, at r_2(x_1) er defineret
Da $b \neq 0$ har vi også, at $y_1 = b / r_2(x_1)$. Dette betyder, at $y_1$ er bestemt
ved $x_1$, så vi behøver kun at tælle værdier for $x_1$. Fra antagelse (2) har vi, at 
$p(x) - aq(x) = 0$ har $\deg \alpha$ rødder talt med multiplicitet. Vi skal altså vise,
at $p-aq$ ikke har nogen multiple rødder. Antag for modstrid, at $x_0$ er en multipel
rod. Da har vi, at
\begin{align*}
	p(x_0) - aq(x_0) = 0 \quad \text{og} \quad p'(x_0) - aq'(x_0) = 0.
\end{align*}
En hurtig omskrivning giver os ligningerne $p(x_0)=aq(x_0)$ og $aq'(x_0)=p'(x_0)$, 
som vi ganger med hinanden og får, at 
\begin{align*}
	a p(x_0)q'(x_0) = ap'(x_0)q(x_0).
\end{align*} 
Da $a \neq 0$ pr. (1) giver det os, at $x_0$ er en rod i $pq'-p'q$ så $x_0 \in S$.
Altså er $a=r_1(x_0) \in r_1(S)$, hvilket er i modstrid med (3). Dermed har 
$p-aq$ netop $\deg \alpha$ forskellige rødder. Da der er præcist $\deg \alpha$ 
punkter $(x_1, y_1)$ så $\alpha(x_1, y_1) = (a, b)$ har kernen for $\alpha$ netop
$\deg \alpha$ elementer.
\end{proof}

\begin{proposition}
Lad $E$ være en elliptisk kurve over $\mathbb{F}_q$ og lad $n \geq 1$. Da gælder der,
at 
\begin{enumerate}
	\item $\ker (\phi_{q}^n - 1) = E(\mathbb{F}_{q^n})$. \label{test}
	\item $\phi_{q}^{n}-1$ er separabel, så $\#E(\mathbb{F}_{q^n})=\deg (\phi_{q}^{n}-1)$. 
\end{enumerate}
\end{proposition}
\begin{proof}
Da $(\phi_{q}^{n} - 1)((x,y)) = 0 \Leftrightarrow (x^q, y^q) = (x, y)$ følger det fra
lemma \ref{lemma03}, at $\ker(\phi_{q}^{n}-1)=E(\mathbb{F}_q)$.

Da $\phi_{q}^{n}$ er Frobenius afbildningen for $\mathbb{F}_q$ følger \eqref{test} fra et 
tidligere lemma. At $\phi_{q}^{n} -1$ er separabel vil vi ikke vise, men et bevis kan findes
i [LW]. Da følger det fra en tidligere proposition, at $\#E(E_{q^n})=\deg(\phi_{q}^{n} -1)$.
\end{proof}

Vi mangler nu blot ét resultat mere før, at vi er i stand til at vise Hasses sætning. Lad først
\begin{align}
	\label{hasse_assist}
	a = q + 1 - \#E(\mathbb{F}_q) = q + 1 - \deg (\phi_q - 1).
\end{align}

\begin{lemma}\label{degree_lemma}
Lad $r, s \in \mathbb{Z}$ være sådan, at $\gcd(s, q) = 1$. Da gælder der, at
\begin{align*}
	\deg(r \phi_q - s) = r^2 q + s^2 - rsa.
\end{align*}
\end{lemma}
\begin{proof}
Vi vil ikke føre beviset her, men et bevis kan findes i [LW].
\end{proof}


\begin{theorem}[Hasse]
Lad $E$ være en elliptisk kurve over $\mathbb{F}_q$. Da gælder der for
$E(\mathbb{F}_q)$, at 
\begin{align*}
	|q+1-\#E(\mathbb{F}_q)| \leq 2 \sqrt{q}.
\end{align*}
\end{theorem}
\begin{proof}
Med notationen fra \eqref{hasse_assist} skal vi vise, at $|a|\leq 2\sqrt{q}$. Da graden
af en endomorfi altid er $\geq 0$ følger det fra lemma \ref{degree_lemma}, at 
\begin{align*}
	r^2q+s^2 -rsa = q \left( \frac{r^2}{s^2} \right) - \frac{rsa}{s^2} + 1 
	\geq 0,
\end{align*}
for alle $r, s \in \mathbb{Z}$ med $\gcd(s, q)=1$. Da mængden
\begin{align*}
	\left\{ \frac{r}{s} \mid \gcd(s, q)=1 \right\} \subseteq \mathbb{Q},
\end{align*}
er tæt i $\mathbb{R}$ følger det, at 
\begin{align*}
	qx^2 - ax + 1 \geq 0,
\end{align*}
for alle $x \in \mathbb{R}$. Dette medfører at diskrimanten må være negativ eller lig $0$.
Altså har vi, at 
\begin{align*}
	a^2 - 4q \leq 0 \Rightarrow |a| \leq 2 \sqrt{q},
\end{align*}
hvilket viser Hasses sætning.
\end{proof}



























